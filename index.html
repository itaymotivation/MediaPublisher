<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>×˜×•×¤×¡ ×©×œ×™×—×ª ×¤×•×¡×˜</title>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://js.puter.com/v2/"></script>
  <link rel="stylesheet" href="index.css" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/he.js"></script>

  <script>


// async function uploadToCloudinary(imageUrl) {
//   const formData = new FormData();
//   formData.append('file', imageUrl);
//   formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);

//   const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
//     method: 'POST',
//     body: formData
//   });

//   const data = await res.json();
//   return data.public_id;
// }

// async function createCloudinaryCollage(publicIds) {
//   const manifest = {
//     template: 'grid',
//     width: 900,
//     height: 900,
//     columns: 3,
//     rows: 1,
//     spacing: 10,
//     background: '#ffffff',
//     color: "#ffffff",
//     assetDefaults: { "kind": "upload", "crop": "fill", "gravity": "auto"},
//     assets: publicIds.map(id => ({ media: id }))
//   };

  
//   const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/create_collage/`, {
//     method: 'POST',
//     headers: { 'Content-Type': 'application/json' },
//     body: JSON.stringify({ manifest_json: JSON.stringify(manifest) })
//   });

//   const data = await res.json();
//   console.log('ğŸ§© Cloudinary Collage:', data.secure_url || data.url);
// }

// (async () => {
//   console.log("ğŸ“¥ Fetching Images...");
//   const unsplash = await fetchUnsplash();
//   const imageUrls = [...unsplash];

  // console.log("â˜ï¸ Uploading to Cloudinary...");
  // const publicIds = [];//['pcladtrqwrj3e4bqrdlh','wwjnsrqlfuao47emv9eo','qle6sywmxmqnudhejxrf'];
  // for (const url of imageUrls) {
  //   try {
  //     const publicId = await uploadToCloudinary(url);
  //     publicIds.push(publicId);
  //   } catch (err) {
  //     console.error("âŒ Upload failed:", err);
  //   }
  // }

  // console.log("ğŸ¨ Creating collages...");
  // if (publicIds.length > 0) {
  //   await createCloudinaryCollage(publicIds);
  // }
// })();




    function CheckShabat() {
      if (new Date().getDay() == 5 || new Date().getDay() == 6)
        window.location.replace('https://itaymotivation.github.io/MediaPublisher/shabat.html');
    }
    function PingServer(guid=101) {
      const intervalId = setInterval(async () => {
          const response = await fetch(`https://mediapublisherbackend.onrender.com/status/${guid}`);
          const data = await response.json();
          const status = data.status;
      }, 7000);
    }

    function GetDataFromLS(){
      const savedData = JSON.parse(localStorage.getItem("postData") || "{}");
      if (savedData.email) $("#email").val(savedData.email);
      if (savedData.content) $("#content").val(savedData.content);
      if (Array.isArray(savedData.socials)) {
          savedData.socials.forEach(id => $(`#${id}`).prop("checked", true));
      }
    }

    function SaveDataToLS(){
      const email = $("#email").val();
      const content = $("#content").val();
      const socials = Array.from(document.querySelectorAll('input[name="platforms"]:checked')).map(cb => cb.id);

      const formData = {
          email: email,
          content: content,
          socials: socials
      };
      
      const history = JSON.parse(localStorage.getItem("postHistory") || "[]");
      history.unshift(formData); // Add latest at the top
      localStorage.setItem("postHistory", JSON.stringify(history.slice(0, 4))); // Keep only 10 entries
    }

    function PublishAsGuest(){
      $("#password").val("111");
      $("#email").val("111");
      $('#postForm button[type="submit"]').click();
      $("#password").val("");
      $("#email").val("");
    }
    function UnsplashAsGuest(){
      $("#password").val("111");
      $("#email").val("111");
      generateImage().then(()=>{
        $("#password").val("");
        $("#email").val("");
      });
    }

    function Validation(selectedPlatforms){
      if (selectedPlatforms.length === 0) {
          Swal.fire({
            icon: 'warning',
            title: '×œ× × ×‘×—×¨×• ×¤×œ×˜×¤×•×¨××•×ª',
            text: '×™×© ×œ×‘×—×•×¨ ×œ×¤×—×•×ª ×¤×œ×˜×¤×•×¨××” ××—×ª ×œ×¤×¨×¡×•×.',
            confirmButtonText: '××™×©×•×¨'
          });
          return -1;
        }

        const fileInput = document.getElementById('media');
        files = fileInput.files;
        const uploadedUrls = [];
        result = {};

        const allowedImageTypes = ['image/jpeg', 'image/jpg', 'image/png'];
        const allowedVideoTypes = ['video/mp4'];

        let hasImage = false;
        let hasVideo = false;
        let videoCount = 0;
        let invalidFiles = [];

        for (const file of files) {
          if (allowedImageTypes.includes(file.type)) {
            hasImage = true;
          } else if (allowedVideoTypes.includes(file.type)) {
            hasVideo = true;
            videoCount++;
          } else {
            invalidFiles.push(file.name);
          }
        }

        if (invalidFiles.length > 0) {
          Swal.fire({
            icon: 'error',
            title: '×©×’×™××”',
            text: `×§×‘×¦×™× ×œ× ×—×•×§×™×™×: ${invalidFiles.join(', ')}. × ×™×ª×Ÿ ×œ×”×¢×œ×•×ª ×¨×§ ×§×‘×¦×™× ××¡×•×’ mp4, jpg, jpeg, png.`,
          });
          return -1;
        }

        if (hasImage && hasVideo) {
          Swal.fire({
            icon: 'warning',
            title: '×©×’×™××”',
            text: '×œ× × ×™×ª×Ÿ ×œ×”×¢×œ×•×ª ×’× ×ª××•× ×•×ª ×•×’× ×¡×¨×˜×•× ×™× ×™×—×“. ×™×© ×œ×‘×—×•×¨ ×¡×•×’ ××“×™×” ××—×“ ×‘×œ×‘×“.',
          });
          return -1;
        }

        if (videoCount > 1) {
          Swal.fire({
            icon: 'error',
            title: '×©×’×™××”',
            text: '× ×™×ª×Ÿ ×œ×”×¢×œ×•×ª ×¨×§ ×¡×¨×˜×•×Ÿ ××—×“ ×‘×›×œ ×¤×¨×¡×•×.',
          });
          return -1;
        }

        if (files.length === 0) {
          Swal.fire({
            icon: 'error',
            title: '×©×’×™××”',
            text: '×™×© ×œ×”×¢×œ×•×ª ×œ×¤×—×•×ª ×§×•×‘×¥ ××—×“ ×œ×¤×•×¡×˜',
          });
          return -1;
        }
        return 0;
    }

    async function GetTempFilesUrl(){
      uploadedUrls=[];
      for (const file of files) {
          const formData = new FormData();
          formData.append('file', file);

          try {
            const response = await fetch('https://tmpfiles.org/api/v1/upload', {
              method: 'POST',
              body: formData
            });

            const data = await response.json();

            if (response.ok) {
              let downloadLink = data.data.url.replace("tmpfiles.org/", "tmpfiles.org/dl/");
              uploadedUrls.push(downloadLink);
            } else {
              console.error(`Failed to upload ${file.name}:`, data);
            }
          } catch (error) {
            console.error(`Error uploading ${file.name}:`, error);
          }
        }
        return uploadedUrls
    }

    function checkStatus(guid) {
      const intervalId = setInterval(async () => {
        try {
          const response = await fetch(`https://mediapublisherbackend.onrender.com/status/${guid}`);
          const data = await response.json();
          const status = data.status;

          // Update the loading message in the modal
          if (Swal.isVisible()) {
            Swal.getHtmlContainer().textContent = `×¡×˜×˜×•×¡ × ×•×›×—×™: ${status}`;
          }

          // Success
          if (status === "×¤×•×¡×˜ ×¤×•×¨×¡× ×‘×”×¦×œ×—×”") {
            clearInterval(intervalId);
            const links = data.results || [];
            Swal.fire({
              icon: 'success',
              title: 'âœ… ×”×¦×œ×—×”',
              html: renderSocialButtons(links),
              confirmButtonText: '×¡×’×•×¨'
            });

            SaveDataToLS();

          }else if(status.includes("×©×’×™××”")){
            clearInterval(intervalId);
            Swal.fire({
              icon: 'error',
              title: 'âŒ ×©×’×™××”',
              text: status,
              confirmButtonText: '×¡×’×•×¨'
            });
          }

        } catch (error) {
          clearInterval(intervalId);
          Swal.fire({
            icon: 'error',
            title: '×©×’×™××” ×‘×¨×©×ª',
            text: '×œ× × ×™×ª×Ÿ ×œ×‘×“×•×§ ××ª ×”×¡×˜×˜×•×¡ ×›×¢×ª. × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨.',
            confirmButtonText: '×¡×’×•×¨'
          });
        }
      }, 3000);
    }


  function renderSocialButtons(links, selectedPlatforms = []) {
  const platforms = [
    { name: "Facebook", key: "facebook", class: "facebook", icon: "fa-facebook-f" },
    { name: "Instagram", key: "instagram", class: "instagram", icon: "fa-instagram" },
    { name: "Twitter X", key: "twitter", class: "twitter", icon: "fa-x-twitter" },
    { name: "Telegram", key: "telegram", class: "telegram", icon: "fa-telegram-plane" }
  ];

  let html = '<div class="result-buttons">';

  platforms
    .filter(p => selectedPlatforms.includes(p.key))
    .forEach(p => {
      const url = links[p.key];
      const isValid = typeof url === 'string' && url.startsWith('http');
      html += `
        <a href="${isValid ? url : '#'}"
           class="result-button ${p.class}"
           style="${!isValid ? 'opacity: 0.5; pointer-events: none;' : ''}"
           target="_blank"
        >
          <i class="fab ${p.icon}"></i> ${p.name} ${isValid ? 'âœ…' : 'âŒ'}
        </a>
      `;
    });

  html += '</div>';
  return html;
}

    

const messages = [];

function addMessage(msg, isUser) {
  const messagesDiv = document.getElementById("messages");
  const messageDiv = document.createElement("div");
  messageDiv.classList.add("message");
  if (isUser) messageDiv.classList.add("user-message");
  messageDiv.textContent = msg;
  messagesDiv.appendChild(messageDiv);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function sendMessage() {
  const input = document.getElementById("input-message");
  //input.value = input.value + " ×¢×“ 250 ×ª×•×•×™× ×‘×ª×©×•×‘×” " // 5 ×¤×•×¡×˜×™× ×œ×™×•× ×œ×˜×•×•×™×˜×¨
  const message = input.value.trim();

  if (message) {
    addMessage(message, true);
    messages.push({ content: message, role: 'user' });
    input.value = '';

    // Show loader
    Swal.fire({
      title: '×××ª×™×Ÿ ×œ×ª×’×•×‘×” ××”×‘×™× ×” ×”××œ××›×•×ª×™×ª...',
      allowOutsideClick: false,
      showConfirmButton: false,
      didOpen: () => {
        Swal.showLoading();
      }
    });

    // Send message to GPT
    puter.ai.chat(messages)
      .then(response => {
        Swal.close(); // Close the loader
        addMessage(response, false);
        messages.push(response.message);
      })
      .catch(error => {
        Swal.fire({
          icon: 'error',
          title: '×©×’×™××”',
          text: '××™×¨×¢×” ×©×’×™××” ×‘×§×‘×œ×ª ×ª×©×•×‘×” ××”×‘×•×˜. × ×¡×” ×©×•×‘.',
        });
        console.error("AI response error:", error);
      });
  }
}


function moveToPost() {
  const lastAIMessage = messages.reverse().find(msg => msg.role !== 'user');
  if (lastAIMessage && lastAIMessage.content) {
    $("#content").val(lastAIMessage.content);
    Swal.fire({
      icon: 'success',
      title: '×”×ª×©×•×‘×” ×”×•×¢×‘×¨×” ×œ×¤×•×¡×˜ âœ¨',
      showConfirmButton: false,
      timer: 1500
    });
    $("#closeChatModal").click();
  } else {
    Swal.fire({
      icon: 'info',
      title: '×œ× × ××¦××” ×ª×©×•×‘×”',
      text: '××™×Ÿ ×ª×©×•×‘×ª GPT ×œ×”×¢×‘×¨×”.',
    });
  }
}

// Modal open/close controls
function openChatModal() {
  document.getElementById("chatModal").style.display = "block";
}

function openImageModal() {
  document.getElementById("imageModal").style.display = "block";
}

function closeImageModal() {
  document.getElementById("imageModal").style.display = "none";
  document.getElementById("imagePrompt").value = "";
}

function useLastGPTResponse() {
  if($("#content").val().trim()!=""){
    document.getElementById("imagePrompt").value = $("#content").val();
    generateImage($("#content").val());
  } else {
    Swal.fire({
      icon: 'info',
      title: '×”×¤×•×¡×˜ ×¨×™×§',
      text: '×œ× × ×™×ª×Ÿ ×œ××¦×•× ××ª ××œ×œ ×”×¤×•×¡×˜.'
    });
  }
}


async function generateImage(prom="") {
    if(prom == "")
      prom = document.getElementById("imagePrompt").value.trim();
    const translationPrompt = "sum the subject of the prompt to 1 word and translate the word to english and return just the word without more explanations: " + prom;
    let translatedSearchTerm;
    
    try {
       Swal.fire({
            title: 'ğŸ¨ ×™×•×¦×¨ ×ª××•× ×”...',
            text: '×× × ×”××ª×Ÿ ××¡×¤×¨ ×©× ×™×•×ª',
            allowOutsideClick: false,
            showConfirmButton: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });
        const chatResponse = await puter.ai.chat(translationPrompt);

        if (!chatResponse || !chatResponse.message) {
            Swal.fire({
                icon: 'warning',
                title: '×—×¡×¨ ×ª×™××•×¨',
                text: '×× × ×”×–×Ÿ ×ª×™××•×¨ ×œ×ª××•× ×”.'
            });
            return;
        }
        translatedSearchTerm = chatResponse.message.content;

    } catch (error) {
        Swal.fire({
            icon: 'error',
            title: '×©×’×™××”',
            text: '××™×¨×¢×” ×©×’×™××” ×‘×ª×¨×’×•× ×”×ª×™××•×¨. ×× × × ×¡×” ×©×•×‘.'
        });
        console.error("Error during translation with puter.ai.chat:", error);
        return;
    }

    imagesFromServer = CreateImagesByTerm(translatedSearchTerm);
}

async function CreateImagesByTerm(searchTerm) {
    try {
        const response = await fetch('https://mediapublisherbackend.onrender.com/images', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ id: $("#password").val(), mail:$("#email").val(), search_term: searchTerm })
        });

        const data = await response.json();

        if (response.ok) {
            console.log('âœ… Image URLs received:', data.message);
            createImageModal(data.message);
        } else {
            if(data.error.includes("×”××¤×¨×¡×")){
            Swal.fire({
              icon: 'error',
              title: data.error,
              text: "×”×× ×ª×¨×¦×” ×œ×™×¦×•×¨ ××ª ×”××“×™×” ×›××•×¨×—?",
              showCancelButton: true,
              confirmButtonText: '×›×Ÿ',
              cancelButtonText: '×œ×'
            }).then((result) => {
                if (result.isConfirmed) {
                  UnsplashAsGuest();
                } else {
                  console.log("User declined guest publishing.");
                }
              })
            }
          else{
            Swal.fire({
              icon: 'error',
              title: '×©×’×™××”',
              text: data.error || '××™×¨×¢×” ×©×’×™××” ×œ× ×™×“×•×¢×” ××”×©×¨×ª.'
            });
            console.error('âŒ Server responded with error:', data.error);
          }
      }
    } catch (error) {
        Swal.fire({
            icon: 'error',
            title: '×©×’×™××”',
            text: '××™×¨×¢×” ×©×’×™××ª ×¨×©×ª ××• ×©×’×™××ª ×¢×™×‘×•×“.'
        });
        console.error('âŒ Network or parsing error:', error);
    }
}


function createImageModal(imageUrls) {
  const tempContainer = document.createElement('div');
  tempContainer.style.display = 'flex';
  tempContainer.style.flexWrap = 'wrap';
  tempContainer.style.gap = '10px';
  tempContainer.style.justifyContent = 'center';

  imageUrls.forEach(url => {
    const link = document.createElement('a');
    link.href = url;
    link.target = '_blank';
    link.style.display = 'inline-block';

    const img = document.createElement('img');
    img.src = url;
    img.style.width = '120px';
    img.style.height = '120px';
    img.style.objectFit = 'cover';
    img.style.cursor = 'pointer';
    img.style.border = '1px solid #ccc';
    img.style.borderRadius = '4px';
    img.alt = 'Image preview';

    link.appendChild(img);
    tempContainer.appendChild(link);
  });

  const imageHTML = tempContainer.innerHTML;

  Swal.fire({
    title: 'ğŸ¨ ×ª××•× ×•×ª ×©× ×•×¦×¨×•',
    html: `<div id="modalImageContainer" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">${imageHTML}</div>`,
    showCancelButton: true,
    confirmButtonText: 'ğŸ“¥ ×”×¢×‘×¨ ×ª××•× ×•×ª ×œ×¤×•×¡×˜',
    cancelButtonText: '×‘×™×˜×•×œ',
    preConfirm: async () => {
      const container = document.getElementById('modalImageContainer');
      const imgs = container.querySelectorAll('img');

      for (const img of imgs) {
        const response = await fetch(img.src);
        const blob = await response.blob();
        const filename = img.src.split('/').pop().split('?')[0]+'.jpg' || 'generated-image.png';
        const file = new File([blob], filename, { type: blob.type });

        selectedFiles.push(file);
      }

      syncFileInput();
      renderMedia();
      closeImageModal();
      Swal.fire({
                icon: 'success',
                title: "×”×ª××•× ×•×ª ×”×•×¢×‘×¨×• ×œ×¤×•×¡×˜",
                showConfirmButton: false,
                timer: 2500,
                timerProgressBar: true
              });
    }
  });
}



function syncFileInput() {
  const dt = new DataTransfer();
  selectedFiles.forEach(file => dt.items.add(file));
  document.getElementById('media').files = dt.files;
}

function removeFileByIndex(indexToRemove) {
  selectedFiles.splice(indexToRemove, 1);
  syncFileInput();
  renderMedia();
}

function renderMedia() {
  const preview = $("#previewArea").empty();

  if (selectedFiles.length > 0) {
    const carousel = $('<div class="carousel"></div>').appendTo(preview);

    selectedFiles.forEach((file, index) => {
      const type = file.type.startsWith("image") ? "img" : "video";
      const reader = new FileReader();

      reader.onload = function (e) {
        const elWrapper = $('<div class="media-wrapper" style="position: relative; display: inline-block; margin: 10px;"></div>');
        const el = $(`<${type} ${type === "video" ? "controls" : ""} src="${e.target.result}" style="max-width: 200px; display: block;"></${type}>`);
        const deleteBtn = $(`<button style="position: absolute; top: 5px; right: 5px;">âŒ</button>`);

        deleteBtn.on("click", function () {
          removeFileByIndex(index);
        });

        elWrapper.append(el).append(deleteBtn);
        carousel.append(elWrapper);
      };

      reader.readAsDataURL(file);
    });
  }
}



function updateScheduleDisplay(dateTime) {
  if (!dateTime) {
    $("#scheduleDisplay").hide();
    $("#selectedDateTime").html('');
    return;
  }
  // ×”××¨×ª ×ª××¨×™×š ×œ×¤×•×¨××˜ ×§×¨×™×
  const dt = new Date(dateTime.replace(" ", "T"));
  const options = { year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false };
  const formatted = dt.toLocaleString('he-IL', options);

  $("#selectedDateTime").text(formatted);
  $("#scheduleDisplay").show();
}


    $(document).ready(function () {
      //CheckShabat();
      PingServer();
      document.getElementById("closeChatModal").addEventListener("click", function () {
      document.getElementById("chatModal").style.display = "none";
      });

      // Optional: Close modal when clicking outside of it
      window.onclick = function(event) {
        const modal = document.getElementById("chatModal");
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }
          document.getElementById("hamburgerMenu").addEventListener("click", function () {
          document.getElementById("actionButtons").classList.toggle("show");
        });

      
       $("#localStorageButton").on("click", function () {
          const history = JSON.parse(localStorage.getItem("postHistory") || "[]");

          let html = `
          <h3 style="font-weight: normal; margin-top: -10px; color: #666;">×œ×—×¥ ×¢×œ ×©×•×¨×” ×›×“×™ ×œ×©×—×–×¨ ××ª ×”×¤×•×¡×˜</h3>
            <div style="max-height:300px; overflow-y:auto; text-align:right;">
              ${history.map((item, index) => `
                <div class="history-row" data-index="${index}" style="cursor:pointer; padding:10px; border-bottom:5px solid #000;">
                  <strong>××™××™×™×œ:</strong> ${item.email || ''}<br/>
                  <strong>×ª×•×›×Ÿ:</strong> ${item.content || ''}<br/>
                  <strong>×¨×©×ª×•×ª:</strong> ${item.socials?.join(", ") || ''}
                </div>
              `).join('')}
            </div>
          `;

          Swal.fire({
              title: '×”×™×¡×˜×•×¨×™×™×ª ×¤×•×¡×˜×™×',
              html: html,
              confirmButtonText: '×¡×’×•×¨',
              didOpen: () => {
                  document.querySelectorAll(".history-row").forEach(row => {
                      row.addEventListener("click", function () {
                          const index = this.getAttribute("data-index");
                          const selectedPost = history[index];
                          if (selectedPost) {
                              $("#email").val(selectedPost.email);
                              $("#content").val(selectedPost.content);
                              $("input[name='platforms']").prop("checked", false);
                              selectedPost.socials.forEach(id => $(`#${id}`).prop("checked", true));
                              Swal.fire({
                              icon: 'success',
                              title: '×”× ×ª×•× ×™× ×©×•×—×–×¨×•',
                              showConfirmButton: false,
                              timer: 1500,
                              timerProgressBar: true
                            });
                          }
                      });
                  });
              }
          });
      });

      $("#infoButton").on("click", function () {
       Swal.fire({
        icon: 'info',
        title: '×ª× ××™ ×©×™××•×© ×‘××ª×¨',
        html: `
          <div style="text-align:right; direction:rtl; max-height:400px; overflow-y:auto; font-size:14px;">
            <ul>
              <li><strong>××—×¨×™×•×ª ×¢×œ ×ª×•×›×Ÿ:</strong> ×›×œ ×”×ª×•×›×Ÿ ×©××•×¢×œ×” ×œ××ª×¨ ×¢×œ ×™×“×™ ×”××©×ª××©×™× (×˜×§×¡×˜×™×, ×ª××•× ×•×ª, ×¡×¨×˜×•× ×™× ×•×›×•') ×”×•× ×‘××—×¨×™×•×ª× ×”×‘×œ×¢×“×™×ª. ×”× ×”×œ×ª ×”××ª×¨ ××™× ×” ××—×¨××™×ª ×œ×›×œ × ×–×§, ×¤×’×™×¢×”, ××• ×”×¤×¨×ª ×–×›×•×™×•×ª ×”× ×•×‘×¢×™× ××”×ª×•×›×Ÿ ×©×¤×•×¨×¡×.</li>
              <li><strong>×©×™××•×© ×—×•×§×™ ×‘×œ×‘×“:</strong> ××™×Ÿ ×œ×”×¢×œ×•×ª ××• ×œ×¤×¨×¡× ×ª×›× ×™× ×©××¤×¨×™× ××ª ×”×—×•×§, ×›×•×œ×œ×™× ×”×¡×ª×”, ×œ×©×•×Ÿ ×”×¨×¢, ×¤×•×’×¢×™× ×‘×–×›×•×™×•×ª ×™×•×¦×¨×™×, ××• ××”×•×•×™× ×›×œ ×ª×•×›×Ÿ ××¡×•×¨ ××• ×‘×œ×ª×™ ×—×•×§×™ ××—×¨.</li>
              <li><strong>×§×‘×¦×™× ××•×ª×¨×™×:</strong> × ×™×ª×Ÿ ×œ×”×¢×œ×•×ª ×œ××ª×¨ ××š ×•×¨×§ ×ª××•× ×•×ª ×‘×¤×•×¨××˜ JPG ××• PNG, ×•×¡×¨×˜×•× ×™× ×‘×¤×•×¨××˜ MP4.</li>
              <li><strong>×¤×¨×¡×•× ×œ×¨×©×ª×•×ª ×—×‘×¨×ª×™×•×ª â€“ ××’×‘×œ×•×ª ×•×©×™×§×•×œ ×“×¢×ª:</strong>
                <ul>
                  <li>×¢×œ ×”××©×ª××©×™× ×œ×•×•×“× ×©×”×©×™××•×© × ×¢×©×” ×‘×”×ª×× ×œ×ª×§× ×•× ×™ ×•×ª× ××™ ×”×©×™××•×© ×©×œ ×”×¨×©×ª×•×ª ×”×—×‘×¨×ª×™×•×ª.</li>
                  <li><strong>×˜×•×•×™×˜×¨:</strong> ××•×’×‘×œ×™× ×œ×¢×“ 5 ×¤×•×¡×˜×™× ×‘×™×•×, ×›××©×¨ ×›×œ ×¤×•×¡×˜ ×œ× ×™×¢×œ×” ×¢×œ 230 ×ª×•×•×™×.</li>
                  <li><strong>×¤×™×™×¡×‘×•×§ ×•××™× ×¡×˜×’×¨×:</strong> ××•×’×‘×œ×™× ×œ×¢×“ 24 ×¤×•×¡×˜×™× ×‘×™×•×.</li>
                  <li><strong>×¤×™×™×¡×‘×•×§:</strong> ×¤×¨×¡×•× ×©×œ ×™×•×ª×¨ ××•×•×™×“××• ××—×“ ×‘×™×•× ×¢×œ×•×œ ×œ×”×•×‘×™×œ ×œ×—×¡×™××ª ×”×—×©×‘×•×Ÿ.</li>
                  <li>×”× ×”×œ×ª ×”××ª×¨ ××™× ×” ××—×¨××™×ª ×œ×—×¡×™××•×ª, ×”×’×‘×œ×•×ª ××• ×›×œ ×¡× ×§×¦×™×” ××—×¨×ª ××¦×“ ×”×¨×©×ª×•×ª ×”×—×‘×¨×ª×™×•×ª ×¢×§×‘ ×©×™××•×© ×©×’×•×™ ××• ××•×¤×¨×–.</li>
                </ul>
              </li>
              <li><strong>××—×¨×™×•×ª ××•×’×‘×œ×ª:</strong> ×”× ×”×œ×ª ×”××ª×¨ ×œ× ×ª×™×©× ×‘××—×¨×™×•×ª ×œ×›×œ × ×–×§ ×™×©×™×¨ ××• ×¢×§×™×£, ×›×¡×¤×™ ××• ××—×¨, ×©×™×™×’×¨× ×¢×§×‘ ×©×™××•×© ×‘××ª×¨, ×ª×§×œ×” ×˜×›× ×™×ª, ××• ×¤×¢×•×œ×” ×©×œ ×¦×“ ×©×œ×™×©×™ ×›×’×•×Ÿ ×—×¡×™××” ×¢×œ ×™×“×™ ×¨×©×ª ×—×‘×¨×ª×™×ª.</li>
              <li><strong>×©××™×¨×” ×¢×œ ×”×–×›×•×™×•×ª:</strong> ×”× ×”×œ×ª ×”××ª×¨ ×©×•××¨×ª ×œ×¢×¦××” ××ª ×”×–×›×•×ª ×œ×”×¡×™×¨ ××• ×œ×—×¡×•× ×›×œ ×ª×•×›×Ÿ ×©× ×¨××” ×œ×” ×›×¤×•×’×¢× ×™, ×‘×œ×ª×™ ×—×•×§×™, ××¤×¨ ×ª× ××™× ××œ×• ××• ×ª× ××™ ×”×©×™××•×© ×©×œ ×¦×“ ×©×œ×™×©×™ â€“ ×•×–××ª ×œ×œ× ×”×•×“×¢×” ××•×§×“××ª.</li>
              <li><strong>×©×™× ×•×™×™× ×‘×ª× ××™×:</strong> ×”× ×”×œ×ª ×”××ª×¨ ×¨×©××™×ª ×œ×¢×“×›×Ÿ ××ª ×ª× ××™ ×”×©×™××•×© ×‘×›×œ ×¢×ª. ×”××©×š ×©×™××•×© ×‘××ª×¨ ×œ××—×¨ ×¢×“×›×•×Ÿ ×”×ª× ××™× ××”×•×•×” ×”×¡×›××” ××—×•×“×©×ª ×œ×ª× ××™×.</li>
              <li><strong>×©×™×¤×•×™:</strong> ×”××©×ª××© ××ª×—×™×™×‘ ×œ×©×¤×•×ª ×•×œ×¤×¦×•×ª ××ª ×”× ×”×œ×ª ×”××ª×¨ ×‘×’×™×Ÿ ×›×œ ×ª×‘×™×¢×”, ×”×•×¦××” ××• × ×–×§ ×©×™×™×’×¨××• ×¢×§×‘ ×”×¤×¨×” ×©×œ ×ª× ××™× ××œ×• ××• ×¢×§×‘ ×©×™××•×© ×‘×œ×ª×™ ×—×•×§×™ ×‘××ª×¨ ××• ×‘×××©×§×™×•.</li>
              <li><strong>×©×™×¤×•×˜ ×•×¡××›×•×ª:</strong> ×ª× ××™× ××œ×• ×›×¤×•×¤×™× ×œ×—×•×§×™ ××“×™× ×ª ×™×©×¨××œ. ×›×œ ×¡×›×¡×•×š ×™×™×“×•×Ÿ ××š ×•×¨×§ ×‘×‘×™×ª ××©×¤×˜ ××•×¡××š ×‘××—×•×– ×ª×œ ××‘×™×‘.</li>
            </ul>
          </div>
        `,
        confirmButtonText: '×”×‘× ×ª×™'
      });

      });

      $("#ClearButton").click(()=>$("#content").val(''));
      $("#SaveButton").click(()=>{
        SaveDataToLS();
        Swal.fire({
          icon: 'success',
          title: '×”× ×ª×•× ×™× × ×©××¨×• "×‘×”×¡×˜×•×¨×™×™×ª ×©×™××•×©"',
          showConfirmButton: false,
          timer: 2000,
          timerProgressBar: true
        });
      });

      $("#TimingButton").click(()=>{ 
          Swal.fire({
          title: '×‘×—×¨ ×ª××¨×™×š ×•×©×¢×” ×œ×¤×¨×¡×•×',
          html: `
              <input id="flatpickrInput" class="swal2-input" placeholder="×‘×—×¨ ×ª××¨×™×š ×•×©×¢×”">
          `,
          didOpen: () => {
              const jewishHolidays = [
                "2025-09-22", "2025-09-23", // ×¨××© ×”×©× ×”
                "2025-10-01", "2025-10-02", // ×™×•× ×›×™×¤×•×¨
                "2025-10-05", "2025-10-12", // ×¡×•×›×•×ª
                "2025-10-13", "2025-10-14", // ×©××™× ×™ ×¢×¦×¨×ª / ×¡×™××—×ª ×ª×•×¨×”
                "2025-12-25", "2025-12-26", // ×—× ×•×›×”
                "2026-03-05", "2026-03-06", // ×¤×•×¨×™×
                "2026-04-02", "2026-04-03", // ×¤×¡×—
                "2026-05-23", "2026-05-24", // ×©×‘×•×¢×•×ª
                "2026-09-14", "2026-09-15", // ×¨××© ×”×©× ×”
                "2026-09-23", "2026-09-24", // ×™×•× ×›×™×¤×•×¨
                "2026-09-27", "2026-10-04", // ×¡×•×›×•×ª
                "2026-10-05", "2026-10-06", // ×©××™× ×™ ×¢×¦×¨×ª / ×¡×™××—×ª ×ª×•×¨×”
                "2026-12-06", "2026-12-07", // ×—× ×•×›×”
                "2027-02-24", "2027-02-25", // ×¤×•×¨×™×
                "2027-04-06", "2027-04-07", // ×¤×¡×—
                "2027-05-15", "2027-05-16", // ×©×‘×•×¢×•×ª
                "2027-09-05", "2027-09-06", // ×¨××© ×”×©× ×”
                "2027-09-14", "2027-09-15", // ×™×•× ×›×™×¤×•×¨
                "2027-09-19", "2027-09-26", // ×¡×•×›×•×ª
                "2027-09-27", "2027-09-28", // ×©××™× ×™ ×¢×¦×¨×ª / ×¡×™××—×ª ×ª×•×¨×”
                "2027-12-25", "2027-12-26", // ×—× ×•×›×”
                "2028-03-01", "2028-03-02", // ×¤×•×¨×™×
                "2028-03-31", "2028-04-01", // ×¤×¡×—
                "2028-05-20", "2028-05-21", // ×©×‘×•×¢×•×ª
                "2028-09-10", "2028-09-11", // ×¨××© ×”×©× ×”
                "2028-09-19", "2028-09-20", // ×™×•× ×›×™×¤×•×¨
                "2028-09-24", "2028-10-01", // ×¡×•×›×•×ª
                "2028-10-02", "2028-10-03", // ×©××™× ×™ ×¢×¦×¨×ª / ×¡×™××—×ª ×ª×•×¨×”
                "2028-12-03", "2028-12-04", // ×—× ×•×›×”
                "2029-03-21", "2029-03-22", // ×¤×•×¨×™×
                "2029-04-11", "2029-04-12", // ×¤×¡×—
                "2029-05-31", "2029-06-01", // ×©×‘×•×¢×•×ª
                "2029-09-21", "2029-09-22", // ×¨××© ×”×©× ×”
                "2029-09-30", "2029-10-01", // ×™×•× ×›×™×¤×•×¨
                "2029-10-05", "2029-10-12", // ×¡×•×›×•×ª
                "2029-10-13", "2029-10-14", // ×©××™× ×™ ×¢×¦×¨×ª / ×¡×™××—×ª ×ª×•×¨×”
                "2029-12-13", "2029-12-14", // ×—× ×•×›×”
                "2030-03-10", "2030-03-11", // ×¤×•×¨×™×
                "2030-04-09", "2030-04-10", // ×¤×¡×—
                "2030-06-12", "2030-06-13", // ×©×‘×•×¢×•×ª
                "2030-09-19", "2030-09-20", // ×¨××© ×”×©× ×”
                "2030-09-28", "2030-09-29", // ×™×•× ×›×™×¤×•×¨
                "2030-10-03", "2030-10-10", // ×¡×•×›×•×ª
                "2030-10-11", "2030-10-12", // ×©××™× ×™ ×¢×¦×¨×ª / ×¡×™××—×ª ×ª×•×¨×”
                "2030-12-25", "2030-12-26", // ×—× ×•×›×”
                "2031-02-26", "2031-02-27", // ×¤×•×¨×™×
                "2031-04-07", "2031-04-08", // ×¤×¡×—
                "2031-05-17", "2031-05-18", // ×©×‘×•×¢×•×ª
                "2031-09-29", "2031-09-30", // ×¨××© ×”×©× ×”
                "2031-10-08", "2031-10-09", // ×™×•× ×›×™×¤×•×¨
                "2031-10-13", "2031-10-20", // ×¡×•×›×•×ª
                "2031-10-21", "2031-10-22", // ×©××™× ×™ ×¢×¦×¨×ª / ×¡×™××—×ª ×ª×•×¨×”
                "2031-12-13", "2031-12-14", // ×—× ×•×›×”
                "2032-03-16", "2032-03-17", // ×¤×•×¨×™×
                "2032-04-05", "2032-04-06", // ×¤×¡×—
                "2032-05-25", "2032-05-26", // ×©×‘×•×¢×•×ª
                "2032-09-07", "2032-09-08", // ×¨××© ×”×©× ×”
                "2032-09-16", "2032-09-17", // ×™×•× ×›×™×¤×•×¨
                "2032-09-21", "2032-09-28", // ×¡×•×›×•×ª
                "2032-09-29", "2032-09-30", // ×©××™× ×™ ×¢×¦×¨×ª / ×¡×™××—×ª ×ª×•×¨×”
                "2032-12-06", "2032-12-07", // ×—× ×•×›×”
                "2033-03-07", "2033-03-08", // ×¤×•×¨×™×
                "2033-03-27", "2033-03-28", // ×¤×¡×—
                "2033-05-16", "2033-05-17", // ×©×‘×•×¢×•×ª
                "2033-09-26", "2033-09-27", // ×¨××© ×”×©× ×”
                "2033-10-05", "2033-10-06", // ×™×•× ×›×™×¤×•×¨
                "2033-10-10", "2033-10-17", // ×¡×•×›×•×ª
                "2033-10-18", "2033-10-19", // ×©××™× ×™ ×¢×¦×¨×ª / ×¡×™××—×ª ×ª×•×¨×”
                "2033-12-25", "2033-12-26", // ×—× ×•×›×”
                "2034-02-21", "2034-02-22", // ×¤×•×¨×™×
                "2034-04-02", "2034-04-03", // ×¤×¡×—
                "2034-05-12", "2034-05-13", // ×©×‘×•×¢×•×ª
                "2034-09-17", "2034-09-18", // ×¨××© ×”×©× ×”
                "2034-09-26", "2034-09-27", // ×™×•× ×›×™×¤×•×¨
                "2034-10-01", "2034-10-08", // ×¡×•×›×•×ª
                "2034-10-09", "2034-10-10", // ×©××™× ×™ ×¢×¦×¨×ª / ×¡×™××—×ª ×ª×•×¨×”
                "2034-12-25", "2034-12-26", // ×—× ×•×›×”
                "2035-03-06", "2035-03-07", // ×¤×•×¨×™×
                "2035-03-26", "2035-03-27", // ×¤×¡×—
                "2035-05-15", "2035-05-16", // ×©×‘×•×¢×•×ª
                "2035-09-25", "2035-09-26", // ×¨××© ×”×©× ×”
                "2035-10-04", "2035-10-05", // ×™×•× ×›×™×¤×•×¨
                "2035-10-09", "2035-10-16", // ×¡×•×›×•×ª
                "2035-10-17", "2035-10-18", // ×©××™× ×™ ×¢×¦×¨×ª / ×¡×™××—×ª ×ª×•×¨×”
                "2035-12-13", "2035-12-14", // ×—× ×•×›×”
                "2036-02-25", "2036-02-26", // ×¤×•×¨×™×
                "2036-04-14", "2036-04-15", // ×¤×¡×—
                "2036-05-04", "2036-05-05", // ×©×‘×•×¢×•×ª
                "2036-09-15", "2036-09-16", // ×¨××© ×”×©× ×”
                "2036-09-24", "2036-09-25", // ×™×•× ×›×™×¤×•×¨
                "2036-09-29", "2036-10-06", // ×¡×•×›×•×ª
                "2036-10-07", "2036-10-08", // ×©××™× ×™ ×¢×¦×¨×ª / ×¡×™××—×ª ×ª×•×¨×”
                "2036-12-04", "2036-12-05", // ×—× ×•×›×”
              ];

              flatpickr("#flatpickrInput", {
                  enableTime: true,
                  dateFormat: "Y-m-d H:00",
                  time_24hr: true,
                  minDate: "today",
                  minuteIncrement: 60,
                  locale: "he",
                  disable: [
                      function (date) {
                          // Disable Fridays (5) and Saturdays (6)
                          return (date.getDay() === 5 || date.getDay() === 6);
                      },
                      ...jewishHolidays
                  ]
              });
          },
          confirmButtonText: '××™×©×•×¨',
          cancelButtonText: '×‘×™×˜×•×œ',
          showCancelButton: true,
          preConfirm: () => {
              const datetime = document.getElementById('flatpickrInput').value;
              if (!datetime) {
                  Swal.showValidationMessage('×× × ×‘×—×¨ ×ª××¨×™×š ×•×©×¢×”');
              }
              return datetime;
          }
          }).then((result) => {
              if (result.isConfirmed) {
                  const selectedDateTime = result.value;
                   updateScheduleDisplay(result.value);
              }
          });
      });

      
      // ×›×¤×ª×•×¨ ××—×™×§×” - ××—×™×§×ª ×”×ª××¨×™×š ×•×ª×¦×•×’×”
      $("#deleteSchedule").click(() => {
        lastChosenDateTime = null;
        updateScheduleDisplay(null);
      });


       $("#money").click(() => {
       const packages = [
        {
          name: "××•×¨×—",
          price: "â‚ª0",
          features: {
            "×ª×–××•×Ÿ ×¤×•×¡×˜×™×": "âŒ",
            "×©×™××•×© ×‘×¦'××˜ GPT ×œ×™×¦×™×¨×ª ×ª××•× ×•×ª": "âœ…",
            "×©×™××•×© ×‘×¦'××˜ GPT ×œ×™×¦×™×¨×ª ×¤×•×¡×˜": "âœ…",
            "×©×™××•×© ×‘×”×™×¡×˜×•×¨×™×™×ª ×¤×•×¡×˜×™×": "âœ…",
            "×¤×¨×¡×•× ×‘×¨×©×ª×•×ª ×—×‘×¨×ª×™×•×ª": "×œ×“×£ ×“××• ×‘×œ×‘×“"
          }
        },
        {
          name: "×‘×¡×™×¡×™",
          price: "â‚ª60",
          features: {
            "×ª×–××•×Ÿ ×¤×•×¡×˜×™×": "âŒ",
            "×©×™××•×© ×‘×¦'××˜ GPT ×œ×™×¦×™×¨×ª ×ª××•× ×•×ª": "âŒ",
            "×©×™××•×© ×‘×¦'××˜ GPT ×œ×™×¦×™×¨×ª ×¤×•×¡×˜": "âœ…",
            "×©×™××•×© ×‘×”×™×¡×˜×•×¨×™×™×ª ×¤×•×¡×˜×™×": "âœ…",
            "×¤×¨×¡×•× ×‘×¨×©×ª×•×ª ×—×‘×¨×ª×™×•×ª": "×œ×¨×©×ª ××—×ª ×‘×œ×‘×“"
          }
        },
        {
          name: "××ª×§×“×",
          price: "â‚ª90",
          features: {
            "×ª×–××•×Ÿ ×¤×•×¡×˜×™×": "âŒ",
            "×©×™××•×© ×‘×¦'××˜ GPT ×œ×™×¦×™×¨×ª ×ª××•× ×•×ª": "âœ…",
            "×©×™××•×© ×‘×¦'××˜ GPT ×œ×™×¦×™×¨×ª ×¤×•×¡×˜": "âœ…",
            "×©×™××•×© ×‘×”×™×¡×˜×•×¨×™×™×ª ×¤×•×¡×˜×™×": "âœ…",
            "×¤×¨×¡×•× ×‘×¨×©×ª×•×ª ×—×‘×¨×ª×™×•×ª": "2 ×¨×©×ª×•×ª ×‘×œ×‘×“"
          }
        },
        {
          name: "×¢×¡×§×™",
          price: "â‚ª130",
          features: {
            "×ª×–××•×Ÿ ×¤×•×¡×˜×™×": "âœ…",
            "×©×™××•×© ×‘×¦'××˜ GPT ×œ×™×¦×™×¨×ª ×ª××•× ×•×ª": "âœ…",
            "×©×™××•×© ×‘×¦'××˜ GPT ×œ×™×¦×™×¨×ª ×¤×•×¡×˜": "âœ…",
            "×©×™××•×© ×‘×”×™×¡×˜×•×¨×™×™×ª ×¤×•×¡×˜×™×": "âœ…",
            "×¤×¨×¡×•× ×‘×¨×©×ª×•×ª ×—×‘×¨×ª×™×•×ª": "×œ×›×œ ×”×¨×©×ª×•×ª"
          }
        }
      ];

// ×—×™×œ×•×¥ ×›×œ ×©××•×ª ×”×¤×™×¦'×¨×™×
const allFeatures = Object.keys(packages[0].features);

// ×‘× ×™×™×ª ×˜×‘×œ×ª HTML
let html = `
  <table class="features-table" dir="rtl">
    <thead>
      <tr style="background:#4a90e2; color:white;">
        <th>×¤×™×¦'×¨</th>
        ${packages.map(pkg => `<th>${pkg.name}<br><span style="font-weight:normal;">${pkg.price}</span></th>`).join('')}
      </tr>
    </thead>
    <tbody>
`;

allFeatures.forEach(feature => {
  html += `
    <tr style="border-bottom:1px solid #ddd;">
      <td>${feature}</td>
      ${packages.map(pkg => `<td>${pkg.features[feature]}</td>`).join('')}
    </tr>
  `;
});

html += `</tbody></table>`;

    Swal.fire({
      title: '×¤×™×¦\'×¨×™× ×•×¢×œ×•×™×•×ª ×—×•×“×©×™×•×ª ×œ××©×ª××©×™×',
      html: html,
      width: '600px',
      confirmButtonText: '×”×¨×©××”',
      cancelButtonText: '×™×¦×™××”',
      showCancelButton:true
    }).then((result) => {
      if (result.isConfirmed) {
        Swal.fire({
        title: '××¢×•× ×™×™×Ÿ ×œ×”×¦×˜×¨×£ ×›××¤×¨×¡×?',
        html: `
          <p>×œ×—×¥ ×¢×œ ×”×›×¤×ª×•×¨ ×œ××˜×” ×œ×©×œ×™×—×ª ×”×•×“×¢×” ××•×›× ×” ×‘×•×•×¦××¤:</p>
          <a href="https://wa.me/972545547237?text=×× ×™%20×¨×•×¦×”%20×œ×§×‘×œ%20×¢×•×“%20×¤×¨×˜×™×%20×¢×œ%20×©×™×¨×•×ª%20×”×¤×¨×¡×•×" target="_blank" class="whatsapp-btn">
            ğŸ“² ×©×œ×— ×”×•×“×¢×” ×‘×•×•××˜×¡××¤
          </a>
        `,
        confirmButtonText: '×¡×’×•×¨',
      });
      }
    })
  });

      // Preview uploads
      selectedFiles = [];
     $("#media").on("change", function () {
        const newFiles = Array.from(this.files);
        selectedFiles = selectedFiles.concat(newFiles);
        syncFileInput();
        renderMedia();
      });


      //On Submit
      document.getElementById('postForm').addEventListener('submit', async function (event) {
         Swal.fire({
          title: '××¢×“×›×Ÿ ×¡×˜×˜×•×¡...',
          text: '×× × ×”××ª×Ÿ',
          allowOutsideClick: false,
          showConfirmButton: false,
          didOpen: () => {
            Swal.showLoading();
          }
        });
        event.preventDefault();
        const publisherId = $("#password").val();
        const publisherMail = $("#email").val();
        const content = $("#content").val();
        const selectedPlatforms = Array.from(document.querySelectorAll('input[name="platforms"]:checked')).map(cb => cb.value);

        isValid=Validation(selectedPlatforms);
        if (isValid!=0) return;
        const uploadedUrls = await GetTempFilesUrl();
        
        const [publishDate, publishTime] = $("#selectedDateTime").html().split(', ');
        const jsonToSend = {
          guid: crypto.randomUUID(),
          id: publisherId,
          mail: publisherMail,
          postContent: content,
          files: uploadedUrls,
          platforms: selectedPlatforms,
          publishDate:publishDate,
          publishTime:publishTime
        };

        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 100000);

       
        // Begin the fetch
        if($("#selectedDateTime").html()=='')
          endpoint = "https://mediapublisherbackend.onrender.com/";
        else
          endpoint = "https://mediapublisherbackend.onrender.com/timing";
        fetch(endpoint, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(jsonToSend),
          signal: controller.signal
        })
        .then(async (response) => {
          const result = await response.json();
          const status = response.status == 200 ? result.message : result.error;
          if (status.includes("×”×¦×œ×—×”")) {
            if(status.includes("×ª×•×–××Ÿ")){
              Swal.fire({
                icon: 'success',
                title: status +' ×œ - '+$("#selectedDateTime").html(),                
                confirmButtonText: '×¡×’×•×¨'
              });
            }else{
              const links = result.results || [];
              Swal.fire({
                icon: 'success',
                title: 'âœ… ×”×¦×œ×—×”',
                html: renderSocialButtons(links,selectedPlatforms),
                confirmButtonText: '×¡×’×•×¨'
              });
            }

            SaveDataToLS();

          }else if(status.includes("×©×’×™××”")){
            if(status.includes("×”××¤×¨×¡×")){
            Swal.fire({
              icon: 'error',
              title: status,
              text: "×”×× ×ª×¨×¦×” ×œ×¤×¨×¡× ×›××•×¨×—?",
              showCancelButton: true,
              confirmButtonText: '×›×Ÿ',
              cancelButtonText: '×œ×'
            }).then((result) => {
              if (result.isConfirmed) {
                PublishAsGuest();
              } else {
                console.log("User declined guest publishing.");
              }
            });
          }else{
            Swal.fire({
              icon: 'error',
              title: 'âŒ ×©×’×™××”',
              text: status,
              confirmButtonText: '×¡×’×•×¨'
            });
          }}
        })
        .catch(error => {
          if (error.name === 'AbortError') {
            Swal.fire({
              icon: 'error',
              title: 'â±ï¸ ×—×¨×’ ××”×–××Ÿ',
              text: '×”×‘×§×©×” ×œ×©×¨×ª ×œ×§×—×” ×™×•×ª×¨ ××“×™ ×–××Ÿ. × ×¡×” ×©×•×‘.',
              confirmButtonText: '×¡×’×•×¨'
            });
          }
        })
        .finally(() => {
          clearTimeout(timeoutId);
        });
        //checkStatus(jsonToSend.guid);
      });
    });
  </script>
</head>

<body>
  <h2 style="text-align: center;">×“×£ ×©×•××¨ ×©×‘×ª ×•×œ× ×™×”×™×” ×–××™×Ÿ ×‘×©×‘×ª×•×ª ×•×—×’×™×</h2>
  <div class="container">
   <!-- Hamburger Button for Mobile -->
<button class="hamburger" id="hamburgerMenu" aria-label="×ª×¤×¨×™×˜ × ×™×•×•×˜">
  ğŸ‘ˆğŸ”´ğŸ‘‰
</button>

<!-- Collapsible menu for mobile -->
<div class="BTNS" id="actionButtons">
  <button type="button" class="info-btn" id="infoButton">
    <i class="fas fa-info-circle" aria-hidden="true"></i> ×ª× ××™×
  </button>
  <button type="button" class="dashboard-button" onclick='window.open("https://itaymotivation.github.io/MediaPublisher/dashboard.html", "_blank")'>×œ×•×— ×‘×§×¨×” ×•×ª×–××•× ×™×</button>
  <button type="button" class="money-btn" id="money">××—×™×¨×•×Ÿ ×•×”×¨×©××”</button>
  <button type="button" class="LS-btn" id="localStorageButton">×”×¡×˜×•×¨×™×™×ª ×©×™××•×©</button>
  <button type="button" class="Timing-btn" id="TimingButton">×ª×–××•×Ÿ ×¤×•×¡×˜</button>
  <button type="button" onclick="openChatModal()" class="gpt-btn" id="gpt">×‘×™× ×” ××œ×›×•×ª×™×ª ×œ× ×™×¡×•×— ×¤×•×¡×˜</button>
  <button onclick="openImageModal()" class="image-btn" id="imageBtn">
    ×‘×™× ×” ××œ×›×•×ª×™×ª ×œ×™×¦×™×¨×ª ×ª××•× ×” ×œ×¤×•×¡×˜
  </button>
</div>

    <h1>×˜×•×¤×¡ ×©×œ×™×—×ª ×¤×•×¡×˜</h1>
    <form id="postForm">
      <div id="scheduleDisplay" style="width:100%; display:none; margin-top:15px; padding:10px; border:1px solid #ccc; border-radius:6px; width:100%; font-family: Arial, sans-serif;">
      <strong>×ª×–××•×Ÿ ×¤×¨×¡×•× × ×‘×—×¨:</strong>
      <span id="selectedDateTime" style="margin-left: 8px;"></span>
      <div style="margin-top:10px;">
        <button type="button" id="deleteSchedule" style="padding:6px 12px; cursor:pointer; background:#e74c3c; color:#fff; border:none; border-radius:4px;">××—×§</button>     
      </div>
    </div>
      <label for="email">××™××™×™×œ:</label>
      <input type="text" id="email" name="email" required />

      <label for="password">×§×•×“ ××©×ª××©:</label>
      <input type="password" id="password" name="password" />

      <label for="content">×ª×•×›×Ÿ ×¤×•×¡×˜:</label>
      <textarea id="content" name="content" required></textarea>
      <div style="display: flex; flex-direction: row; justify-content: space-between;">
        <button type="button" class="Clear-btn" id="ClearButton">××—×§ ××ª ××œ×œ ×”×¤×•×¡×˜</button>
        <button type="button" class="Save-btn" id="SaveButton">×©××™×¨×” ×–×× ×™×ª</button>
      </div>
      <label for="media">×§×•×‘×¦×™ ×ª××•× ×” ××• ×•×™×“××•:</label>
      <input type="file" id="media" name="media" accept="image/*,video/*" multiple />
 <div class="preview-area" id="previewArea"></div>
      <label>×‘×—×¨ ×¤×œ×˜×¤×•×¨××•×ª ×œ×¤×¨×¡×•×:</label>
<div class="social-checkboxes">
  <input type="checkbox" id="facebook" name="platforms" value="facebook">
  <label for="facebook" class="facebook"><i class="fab fa-facebook-f"></i> ×¤×™×™×¡×‘×•×§</label>

  <input type="checkbox" id="instagram" name="platforms" value="instagram">
  <label for="instagram" class="instagram"><i class="fab fa-instagram"></i> ××™× ×¡×˜×’×¨×</label>

  <input type="checkbox" id="twitter" name="platforms" value="twitter">
  <label for="twitter" class="twitter"><i class="fab fa-x-twitter"></i> ×˜×•×•×™×˜×¨ X</label>

  <input type="checkbox" id="telegram" name="platforms" value="telegram">
  <label for="telegram" class="telegram"><i class="fab fa-telegram-plane"></i> ×˜×œ×’×¨×</label>
</div>
      <button type="submit" class="button">×¤×¨×¡× ×›××©×ª××© ×¨×©×•×</button>
      <button type="button" onclick="PublishAsGuest()" class="button">×¤×¨×¡× ×›××•×¨×—</button>
    </form>

    <!-- Chat Modal -->
<div id="chatModal" class="modal" style="padding: 0px 5px 0px 0px;">
  <div class="modal-content">
    <span class="close" id="closeChatModal">&times;</span>
   <div class="chat-body">
  <div id="messages" class="messages-container"></div>
  <textarea type="text" id="input-message" placeholder="×›×ª×•×‘ ×œ×™ ×¤×•×¡×˜ ××•×©×š ×œ×™×“×™× ×¢×œ..."></textarea>
</div>
<div class="modal-footer">
  <button onclick="sendMessage()">×©×œ×— ×‘×§×©×” ×œ×‘×•×˜</button>
  <button onclick="moveToPost()">×”×¢×‘×¨ ××ª ×ª×©×•×‘×ª ×”×‘×•×˜ ×œ×¤×•×¡×˜</button>
</div>
  </div>
</div>

<!-- Image Generation Modal -->
<div style="display: flex; align-items: flex-start; gap: 20px;">
  <div id="imageModal" class="modal" style="padding: 0px 5px 0px 0px;">
    <div class="modal-content">
      <span class="close" onclick="closeImageModal()">&times;</span>
      <h3>ğŸ¨ ×™×¦×™×¨×ª ×ª××•× ×” ×¢× ×‘×™× ×” ××œ×›×•×ª×™×ª</h3>

      <textarea id="imagePrompt" placeholder="×›×ª×•×‘ ×›××Ÿ ×ª×™××•×¨ ×œ×ª××•× ×”..." rows="7" style="width: -webkit-fill-available;margin-bottom: 15px;"></textarea>
      <div class="modal-footer">

        <button onclick="useLastGPTResponse()">×¦×•×¨ ×ª××•× ×” ×™×©×¨ ××”×¤×•×¡×˜</button>
        <button onclick="generateImage()">ğŸš€ ×¦×•×¨ ×ª××•× ×” ××”×ª×™××•×¨ ×œ××¢×œ×”</button>
      </div>
    </div>
  </div>
</div>
  </div>
</body>
</html>
