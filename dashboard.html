<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>לוח בקרה</title>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://js.puter.com/v2/"></script>
  <link rel="stylesheet" href="index.css" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/he.js"></script>

<script>
function GetPostMedia(element) {
 endpoint = "https://mediapublisherbackend.onrender.com/getPostMedia";
      const jsonToSend = {
        guid: crypto.randomUUID(),
        postId:element.id
      }
      fetch(endpoint, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(jsonToSend)
        })
        .then(async (response) => {
          const result = await response.json();
        })      
}

function deletePost(timingId) {
      Swal.fire({
        title: 'האם למחוק את התזמון?',
        text: "לא תוכל לשחזר אותו לאחר מכן!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'כן, מחק!',
        cancelButtonText: 'ביטול'
      }).then((result) => {
        if (result.isConfirmed) {
          const card = document.querySelector(`[data-id="${timingId}"]`);
          if (card) card.remove();

          Swal.fire(
            'נמחק!',
            'התזמון הוסר בהצלחה.',
            'success'
          );

          // כאן תוכל גם לשלוח בקשת DELETE לשרת אם יש API
        }
      });
    }

$(document).ready(()=>{
  Swal.fire({
    title: 'כניסה לחשבון',
    html:
      '<input type="email" id="swal-input-email" class="swal2-input" placeholder="אימייל">' +
      '<input type="password" id="swal-input-password" class="swal2-input" placeholder="סיסמה">',
    icon: 'info',
    confirmButtonText: 'התחבר',
    showCancelButton: true,
    cancelButtonText: 'ביטול',
    preConfirm: () => {
      const email = document.getElementById('swal-input-email').value;
      const password = document.getElementById('swal-input-password').value;

      if (!email || !password) {
        Swal.showValidationMessage('נא למלא את כל השדות');
      }

      return { email, password };
    }
  }).then((result) => {
    if (result.isConfirmed) {
      const { email, password } = result.value;
      console.log("✉️ אימייל:", email);
      console.log("🔐 סיסמה:", password);
      endpoint = "https://mediapublisherbackend.onrender.com/getTimings";
      const jsonToSend = {
        guid: crypto.randomUUID(),
        id: password,
        mail: email
      }
      fetch(endpoint, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(jsonToSend)
        })
        .then(async (response) => {
          const result = await response.json();
          const container = document.getElementById('postsContainer');

          result.forEach(post => {
            const card = document.createElement('div');
            card.className = 'post-card';
            card.setAttribute('data-id', post.timingId);

            const files = post.filesLink.split(';').map(file => file.trim()).filter(Boolean);
            const filesHTML = `<button onclick="GetPostMedia(this)" id="${post.timingId}">שלוף את קבצי הפוסט</button>`;

            card.innerHTML = `
              <div class="post-title">🗓 תזמון פרסום</div>
              <div class="post-detail"><strong>תוכן:</strong> ${post.content}</div>
              <div class="post-detail"><strong>תאריך:</strong> ${post.publishDate}</div>
              <div class="post-detail"><strong>שעה:</strong> ${post.publishTime}</div>
              <div class="post-detail"><strong>פלטפורמות:</strong> ${post.platforms}</div>
              <div class="post-detail"><strong>מייל מפרסם:</strong> ${post.publisherMail}</div>
              <div class="post-files">${filesHTML}</div>
              <button class="delete-button" onclick="deletePost('${post.timingId}')">🗑️ מחיקת תזמון</button>
            `;

            container.appendChild(card);
          });

        })
        }
  });

});
</script>
</head>

<body>
 
    <h1>לוח בקרה</h1>
      <div class="container">
    <h1>לוח תזמונים</h1>

    <div class="posts-container" id="postsContainer">
    <!-- פוסטים ייכנסו כאן -->
  </div>

</body>
</html>
