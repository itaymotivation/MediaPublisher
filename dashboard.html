<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>×œ×•×— ×‘×§×¨×”</title>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="index.css" />


<script>
function GetPostMedia(element) {
 endpoint = "https://mediapublisherbackend.onrender.com/getPostMedia";
      const jsonToSend = {
        guid: crypto.randomUUID(),
        postId:element.id
      }
      fetch(endpoint, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(jsonToSend)
        })
        .then(async (response) => {
          const result = await response.json();
        })      
}

function deletePost(timingId) {
      Swal.fire({
        title: '×”×× ×œ××—×•×§ ××ª ×”×ª×–××•×Ÿ?',
        text: "×œ× ×ª×•×›×œ ×œ×©×—×–×¨ ××•×ª×• ×œ××—×¨ ××›×Ÿ!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: '×›×Ÿ, ××—×§!',
        cancelButtonText: '×‘×™×˜×•×œ'
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire({
          title: '××¢×“×›×Ÿ ×¡×˜×˜×•×¡...',
          text: '×× × ×”××ª×Ÿ',
          allowOutsideClick: false,
          showConfirmButton: false,
          didOpen: () => {
            Swal.showLoading();
          }
        });
          endpoint = "https://mediapublisherbackend.onrender.com/deleteTiming";
          const jsonToSend = {
            guid: crypto.randomUUID(),
            id: password,
            mail: email,
            timingId: timingId
          }
          fetch(endpoint, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(jsonToSend)
            })
            .then(async (response) => {
              const result = await response.json();
              if(status.ok){
                const card = document.querySelector(`[data-id="${timingId}"]`);
                if (card) card.remove();
                Swal.fire(
                  '× ××—×§!',
                  '×”×ª×–××•×Ÿ ×”×•×¡×¨ ×‘×”×¦×œ×—×”.',
                  'success'
                );
              }else{
                 Swal.fire({
                icon: 'error',
                title: 'âŒ ×©×’×™××”',
                text: "",
                confirmButtonText: '×¡×’×•×¨'
            });
              }
            })
        }
      });
    }

$(document).ready(()=>{
  Swal.fire({
    title: '×›× ×™×¡×” ×œ×—×©×‘×•×Ÿ',
    html:
      '<input type="email" id="swal-input-email" class="swal2-input" placeholder="××™××™×™×œ">' +
      '<input type="password" id="swal-input-password" class="swal2-input" placeholder="×§×•×“ ××©×ª××©">',
    icon: 'info',
    confirmButtonText: '×”×ª×—×‘×¨',
    showCancelButton: true,
    cancelButtonText: '×‘×™×˜×•×œ',
    preConfirm: () => {
      email = document.getElementById('swal-input-email').value;
      password = document.getElementById('swal-input-password').value;

      if (!email || !password) {
        Swal.showValidationMessage('× × ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª');
      }

      return { email, password };
    }
  }).then((result) => {
    if (result.isConfirmed) {
      Swal.fire({
          title: '×©×•×œ×£ × ×ª×•× ×™×...',
          text: '×× × ×”××ª×Ÿ',
          allowOutsideClick: false,
          showConfirmButton: false,
          didOpen: () => {
            Swal.showLoading();
          }
        });
      const { email, password } = result.value;
      endpoint = "https://mediapublisherbackend.onrender.com/getTimings";
      const jsonToSend = {
        guid: crypto.randomUUID(),
        id: password,
        mail: email
      }
      fetch(endpoint, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(jsonToSend)
        })
        .then(async (response) => {
          const result = await response.json();
          const container = document.getElementById('postsContainer');
          if (result.results && result.results.length > 0) {
            Swal.fire(
                  '×”×ª×–××•× ×™× × ×©×œ×¤×• ×‘×”×¦×œ×—×”!',
                  '',
                  'success'
                );
            result.results.forEach(post => {
            const card = document.createElement('div');
            card.className = 'post-card';
            card.setAttribute('data-id', post.timingId);

            const files = post.filesLink.split(';').map(file => file.trim()).filter(Boolean);
            const filesHTML = `<button onclick="GetPostMedia(this)" id="${post.timingId}">×©×œ×•×£ ××ª ×§×‘×¦×™ ×”×¤×•×¡×˜</button>`;

            card.innerHTML = `
              <div class="post-title">ğŸ—“ ×ª×–××•×Ÿ ×¤×¨×¡×•×</div>
              <div class="post-detail"><strong>×ª×•×›×Ÿ:</strong> ${post.content}</div>
              <div class="post-detail"><strong>×ª××¨×™×š:</strong> ${post.publishDate}</div>
              <div class="post-detail"><strong>×©×¢×”:</strong> ${post.publishTime}</div>
              <div class="post-detail"><strong>×¤×œ×˜×¤×•×¨××•×ª:</strong> ${post.platforms}</div>
              <div class="post-detail"><strong>××™×™×œ ××¤×¨×¡×:</strong> ${post.publisherMail}</div>
              <div class="post-files">${filesHTML}</div>
              <button class="delete-button" onclick="deletePost('${post.timingId}')">ğŸ—‘ï¸ ××—×™×§×ª ×ª×–××•×Ÿ</button>
            `;

            container.appendChild(card);
          });
        }else{
           Swal.fire(
                  '××™×Ÿ ×ª×–××•× ×™× ×œ×”×¦×’×”!',
                  '',
                  'success'
                );
          const container = document.getElementById('postsContainer');
          container.innerHTML = '<div style="text-align:center; color: #888;">××™×Ÿ ×ª×–××•× ×™× ×œ×”×¦×’×”</div>';
        }
        })
        }
  });

});
</script>
</head>

<body>
 
    <h1>×œ×•×— ×‘×§×¨×”</h1>
      <div class="container">
    <h1>×œ×•×— ×ª×–××•× ×™×</h1>

    <div class="posts-container" id="postsContainer">
    <!-- ×¤×•×¡×˜×™× ×™×™×›× ×¡×• ×›××Ÿ -->
  </div>

</body>
</html>
